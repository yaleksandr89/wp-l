## Комментария по уроку ##

В задание не было задачи создать страницу блога - не стал выносить её в меню. Но саму [страницу создал](https://wp.alexanderyurchenko.ru/blog/), 
так как по неё есть вопрос, который не мог решить самостоятельно.


## Вопросы по уроку ##

### 1. Виджеты ###

Когда стал разносить информацию, понял, что стандартные виджеты крайне скудны. Из готовых
решений смог воспользоваться только виджетом "Категорий" (для главной страницы). 

Для подвала, подошел виджет "HTML-код". Но виджеты для одиночной страницы - функции Wordpress, то есть PHP, а он из коробки
не поддерживается WP). 

Отталкивался от варианта - разобраться самому, а не подключать плагины. Решения с помощью фильтров, 
которые присутвуют в сети - не полностью рабочие. Они практически однотипны, вот один из них:

```php
add_filter('widget_text', static function ($widget_content) {
    if (strpos($widget_content, '<' . '?') !== false) {
        ob_start();
        eval('?' . '>' . $widget_content);
        $widget_content = ob_get_clean();
    }
    return $widget_content;
}, 99);
``` 
Создание виджета с помощью "Текст" - в целом работает, но использовать его не стал, так как если в созданном виджете перейти 
на вкладку "визуально", спец.символы экранируются и скрипт ломается. 

С помощью "HTML-код" - возникает ошибка валидации, при появлении символов **&lt;?**, **?&gt;** и нет возможности сохранить 
внесеные изменения. Добавить в список валидации символы: **&lt;?**, **?&gt;** - не смог, поэтому решил вопрос следующим образом:
- Начало скрипта: `%start_PHP%`
- Конец скрипта: `%stop_PHP%`
- При использование `->`: `-&gt;`

```php
add_filter('widget_text', static function ($widget_content) {
    // Fix warning (why not do save widget)
    $widget_content = str_replace(['%start_PHP%', '%stop_PHP%', '-&gt;'], ['<?php', '?>', '->'], $widget_content);

    if (strpos($widget_content, '<' . '?') !== false) {
        ob_start();
        eval('?' . '>' . $widget_content);
        $widget_content = ob_get_clean();
    }
    return $widget_content;
}, 99);
``` 

Пример виджета вывода тегов записи:
```html
%start_PHP%
the_tags('<ul class="secondery-navigation"><li>', '</li><li>', '</li></ul>') 
%stop_PHP%
```

Собственно несколько вопросов:

1. Насколько "адекватно" мое решение?
2. Стоит ли так заморачиваться при создание садбаров или проще оформить все в файлах темы, без "пляскок с бубном" для адаптации 
PHP скрипта в виджте "HTML-код"?

### 2. Иерархия файлов шаблона ###

Изучив [Иерархия файлов темы (шаблона)](https://wp-kama.ru/id_7654/ierarhiya-fajlov-temy-shablona.html#stranitsa-bloga) у меня встал вопрос -
а зачем вообще указывать статические страницы (в админке), если этот функционал можно построить с помощью иерархии  файтов темы :).

#### 1 вариант (не подошел) ####

- Главная страница: front-page.php
- Страница записей: home.php

Не подошел по причине того, что  это не сильно отличается от варианта указания статических страниц через админку. Главная (front-page) 
будет использоваться без проблем, но вот home срабатывает, только тогода когда в админке выбрана статическая страница для записейю.

#### 2 вариант (не подошел) ####

- Главная страница: home.php
- Стараница записей: category.php

Вариант идеален, если в блоге используется одна рубрика для постов - устанавливается плагин `No Category Base (WPML)` (либо вручную удалить префикс category/),
и файл category использоваться под страницу записей. Но в рамках данной задачи - увы не смог апдаптировать (используется куча рубрик).

#### 3 вариант (который используется сейчас) ####

- Главная страница: front-page.php
- Страница записей: page-blog.php

Страницу для записей просто создаю в админке (с слагом blog), далее по приоритету она проверяется (и соответвенно подключается), перед page.php

Также пару вопросов :)

1. Какой вариант реализации более правильный. Поделитесь, как вы реализовываете иерархию при создание блога.
2. Почему я стал перебирать варианты организации иерархии и так и не смог решить. Так как динамический ЧПУ у меня строится по правилу: 
`/%category%/%postname%/` я хотел реализовать ЧПУ у записей блога, как вы и советовали:

```
/blog/category/article-1
/blog/category/article-2
...
```

Но ни онид из вышеперечисленных вариантов не подходит. Так как если изменить правило формирования ЧПУ, например, на: `/blog/%category%/%postname%/`
то на страницах таксономии(category.php, tag.php) мы получим:

```
/blog/tag/tag-1/
или
/blog/category/tag-1/
``` 

Что не совсем правильно. Гуглив этот вопрос я наткнулся на [WP_Rewrite{}](https://wp-kama.ru/function/wp_rewrite), 
[add_rewrite_tag()](https://wp-kama.ru/function/add_rewrite_tag) ,[add_rewrite_rule()](https://wp-kama.ru/function/add_rewrite_rule) -
и с помощью класса WP_Rewrite{} и его методов, пытался **динамически** подставлять префикс: `blog/`, но не смог этого сделать.

Соответвенно не могли бы подсказать, как сохранить структуру УРЛ для одиночных записей (/blog/category/article...) - возможно ли динамически
подставлять этот префикс или есть иной путь решения?


#### UPD 11.08.2020 ####

##### Вопрос 2 #####

Нашел решение, воспользовался фильтром `'post_link'` и в процессе формирования УРЛ записи добавил префикс `blog`:

```php
add_filter('post_link', static function ($post_link, $post) {
    if ($post->post_type === 'post') {
        return str_replace(get_bloginfo('home'), get_bloginfo('home') . '/blog', $post_link);
    }
    return $post_link;
}, 10, 2);
```

Но все же, если возможно могли бы затронуть тему [WP_Rewrite{}](https://wp-kama.ru/function/wp_rewrite#9-udalenie-nazvaniya-tipa-zapisi-iz-url), очень
интересный функционал. Получается в Wordpress можно гибко настраивать роутинг (хотя для решения своего вопроса этим классом так и не воспользовался). 
Ранее я думал, что маршруты можно строить только на странице "Настройки постоянных ссылок" :)



 